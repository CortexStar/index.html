<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF → ZIP · One-touch</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* ——— layout & visuals ——— */
    *{box-sizing:border-box;margin:0;padding:0}
    body{height:100vh;display:flex;align-items:center;justify-content:center;
         background:#eef1f6;font-family:system-ui,sans-serif;color:#222}
    .card{width:100%;max-width:1100px;height:100%;display:flex;flex-direction:column}

    /* giant input + button (upper ~25 vh) */
    .input-wrap{flex:0 0 25vh;display:flex;align-items:center;justify-content:center;padding:1rem 2rem}
    .inner{width:100%;height:100%;display:flex;flex-direction:column;gap:1rem}
    .inner>*{width:100%}
    .name-input{flex:1;border:3px solid #ccc;border-radius:18px;font-size:2.2rem;
                padding:.4em .6em;text-align:center}
    .download-btn{flex:0 0 12vh;background:#0066ff;color:#fff;border:none;border-radius:18px;
                  font-size:2rem;font-weight:600;cursor:pointer;transition:.15s}
    .download-btn:hover{background:#0052d1}

    /* drag zone fills the rest */
    .drop-zone{flex:1;border:3px dashed #a2a6ae;border-radius:22px;margin:1.5rem 2rem;
               display:flex;flex-direction:column;align-items:center;justify-content:center;
               cursor:pointer;text-align:center;transition:.25s}
    .drop-zone.drag{border-color:#0066ff;background:#f3f8ff}
    .drop-zone input{display:none}
    .drop-zone i{font-size:4rem;color:#0066ff;margin-bottom:1rem}
    .dz-title{font-size:1.6rem;font-weight:600}
    .dz-sub{font-size:1.05rem;color:#666}

    /* list & message */
    .file-list{font-size:1.15rem;margin:1rem 2rem 0}
    .file-item{background:#f7f8fa;border-radius:12px;padding:12px 16px;margin-top:12px;
               display:flex;justify-content:space-between;align-items:center}
    .file-item span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
    .file-item button{border:none;background:none;color:#d32f2f;font-size:1.4rem;cursor:pointer}
    .msg{font-size:1.05rem;text-align:center;color:#d32f2f;height:1.05em;margin-top:4px}
    @media(max-width:640px){.name-input{font-size:1.8rem}.download-btn{font-size:1.7rem}}
  </style>
</head>
<body>
  <div class="card">
    <!-- Name + button -->
    <div class="input-wrap" id="inputWrap">
      <div class="inner">
        <input id="zipName" class="name-input" type="text" placeholder="zip name">
        <button id="makeZip" class="download-btn">Download ZIP</button>
      </div>
    </div>

    <!-- Drag zone -->
    <label class="drop-zone" id="dropZone">
      <input id="fileInput" type="file" accept="application/pdf" multiple>
      <i class="fa-regular fa-file-pdf"></i>
      <div class="dz-title">Drag &amp; Drop PDFs</div>
      <div class="dz-sub">(or click to browse)</div>
    </label>

    <div id="fileList" class="file-list"></div>
    <div id="msg" class="msg"></div>
  </div>

  <script>
    /* —— DOM refs —— */
    const zipNameEl = document.getElementById('zipName');
    const makeBtn   = document.getElementById('makeZip');
    const inputWrap = document.getElementById('inputWrap');
    const dz        = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileList  = document.getElementById('fileList');
    const msgEl     = document.getElementById('msg');

    let files = [];

    /* ─── 1. Enhanced clipboard autofill ─── */
    let clipboardAvailable = false;

    // Check if clipboard is available
    function checkClipboardAvailability() {
      clipboardAvailable = !!(navigator.clipboard?.readText);
    }

    // Always try to read clipboard and fill input
    async function fillFromClipboard() {
      if (!clipboardAvailable) return false;
      
      try {
        const clipText = await navigator.clipboard.readText();
        const trimmedText = clipText.trim();
        
        if (trimmedText) {
          // Clean the text - remove common file extensions
          const cleanText = trimmedText.replace(/\.(zip|pdf|txt|doc|docx)$/i, '');
          zipNameEl.value = cleanText;
          return true;
        }
      } catch (error) {
        // Permission denied or other error - disable future attempts
        console.log('Clipboard access denied or failed');
        clipboardAvailable = false;
      }
      return false;
    }

    // Initialize clipboard functionality
    async function initClipboard() {
      checkClipboardAvailability();
      
      if (clipboardAvailable) {
        // Try to fill on page load
        await fillFromClipboard();
        
        // Listen for clipboard permission changes
        if (navigator.permissions) {
          try {
            const permission = await navigator.permissions.query({ name: 'clipboard-read' });
            permission.addEventListener('change', () => {
              checkClipboardAvailability();
            });
          } catch (e) {
            // Some browsers don't support clipboard-read permission query
          }
        }
      }
    }

    // Focus event handler - always try to fill from clipboard
    zipNameEl.addEventListener('focus', async () => {
      if (!clipboardAvailable) {
        checkClipboardAvailability(); // Re-check in case permissions changed
      }
      
      if (clipboardAvailable) {
        await fillFromClipboard();
      }
    });

    // Initialize on page load
    initClipboard();

    // Touch anywhere on big header focuses the input
    inputWrap.addEventListener('click', () => zipNameEl.focus());

    /* ─── 2. Drag & drop everywhere ─── */
    const highlight = on => dz.classList.toggle('drag', on);
    ['dragenter','dragover'].forEach(t =>
      window.addEventListener(t, e => { e.preventDefault(); highlight(true); }, false));
    ['dragleave','drop'].forEach(t =>
      window.addEventListener(t, e => { e.preventDefault(); highlight(false); }, false));
    window.addEventListener('drop', e => addFiles(e.dataTransfer.files), false);
    fileInput.addEventListener('change', () => addFiles(fileInput.files));

    /* helpers */
    const msg = t => { msgEl.textContent = t };
    const mb  = b => (b/1048576).toFixed(1)+' MB';
    const render = () => {
      fileList.innerHTML = files.map((f,i)=>`
        <div class="file-item">
          <span title="${f.name}">${f.name} (${mb(f.size)})</span>
          <button onclick="removeFile(${i})">&times;</button>
        </div>`).join('');
    };
    window.removeFile = i => { files.splice(i,1); render(); msg(''); };

    function addFiles(list){
      for(const f of list){
        if(files.length>=2){msg('Maximum two PDFs');break;}
        if(f.type==='application/pdf') files.push(f);
      }
      render(); msg('');
    }

    /* ─── 3. Create ZIP ─── */
    async function createZip(){
      const name=(zipNameEl.value.trim()||'pdfs')+'.zip';
      msg('Creating ZIP…');
      const zip=new JSZip();
      await Promise.all(files.map(f=>f.arrayBuffer().then(b=>zip.file(f.name,b))));
      const blob=await zip.generateAsync({type:'blob'});
      const a=Object.assign(document.createElement('a'),{
        href:URL.createObjectURL(blob),download:name});
      a.click(); URL.revokeObjectURL(a.href);
      reset();
    }

    function tryDownload(){
      if(!files.length)           {msg('Add at least one PDF');return;}
      if(files.length>2)          {msg('Maximum two PDFs');return;}
      if(!zipNameEl.value.trim()) {msg('Enter a name');return;}
      createZip();
    }
    makeBtn.addEventListener('click', tryDownload);

    /* right-click / two-finger click triggers download */
    window.addEventListener('contextmenu', e=>{
      if(e.target.closest('#zipName')) return;  // keep default menu in input
      e.preventDefault(); tryDownload();
    });

    /* reset after download */
    async function reset(){
      files=[]; fileInput.value=''; render(); msg('');
      zipNameEl.value='';          // start fresh
      
      // Fill from clipboard again after reset
      if (clipboardAvailable) {
        await fillFromClipboard();
      }
    }

    /* Enter key turns into button click */
    document.addEventListener('keydown', e=>{
      if(e.key==='Enter') makeBtn.click();
    });
  </script>
</body>
</html>